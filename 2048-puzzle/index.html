<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Ensure proper rendering and touch zooming disable for mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>2048 Puzzle - Stages</title>
    <style>
        /* Basic Reset & Body Styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }

        html, body {
            height: 100%; /* Ensure body takes full height */
            overflow: hidden; /* Prevent scrolling */
        }

        body {
            font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center; /* Center vertically */
            background-color: #faf8ef;
            color: #776e65;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 10px; /* Add some padding around the container */
        }

        /* Game Container */
        .game-container {
            width: 100%;
            max-width: 500px; /* Max width for larger screens */
            height: 95%; /* Max height relative to viewport */
            max-height: 700px; /* Absolute max height */
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px; /* Padding inside container */
            background-color: #faf8ef; /* Match body */
        }

        /* Start Screen */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(250, 248, 239, 0.9); /* Slightly more opaque */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 100; /* High z-index */
            border-radius: 6px;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
            visibility: visible;
            opacity: 1;
             padding: 20px;
        }

        #start-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        #start-screen h1 {
            font-size: clamp(2.5em, 8vw, 3.5em); /* Responsive font size */
            color: #776e65;
            margin-bottom: 15px;
        }

        #start-screen p {
            font-size: clamp(0.9em, 3vw, 1.1em);
            margin-bottom: 20px;
            max-width: 90%;
            line-height: 1.4;
        }

        #start-high-score-display {
            font-size: clamp(1em, 4vw, 1.2em);
            margin-bottom: 30px;
            color: #555;
        }
        #start-high-score-display span {
             font-weight: bold;
             color: #776e65;
        }

        #start-button {
            padding: 12px 25px;
             font-size: clamp(1em, 4vw, 1.2em);
            font-weight: bold;
            cursor: pointer;
            border: none;
            background-color: #8f7a66;
            color: white;
            border-radius: 5px;
            transition: background-color 0.2s ease;
        }

        #start-button:hover {
            background-color: #776e65;
        }


        /* Game Header */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 15px; /* Reduced margin */
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 10px;
        }

        .game-header h1 {
            font-size: clamp(2em, 7vw, 3em);
            font-weight: bold;
            margin: 0;
            flex-shrink: 0; /* Prevent title from shrinking too much */
        }

        .score-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap; /* Allow scores to wrap */
            justify-content: flex-end; /* Align to the right */
        }

        .score-box {
            background-color: #bbada0;
            padding: 5px 10px; /* Slightly smaller padding */
            border-radius: 3px;
            text-align: center;
            min-width: 60px; /* Smaller min-width */
            flex-grow: 1; /* Allow boxes to grow */
            flex-basis: 60px; /* Base width */
        }

        .score-title {
            font-size: clamp(0.7em, 2.5vw, 0.8em);
            color: #eee4da;
            display: block;
            margin-bottom: 1px;
            font-weight: normal;
            text-transform: uppercase;
        }

        .score-value {
            font-size: clamp(1.1em, 4vw, 1.4em);
            font-weight: bold;
            color: white;
             line-height: 1.1;
        }

        /* Controls Area */
         .controls {
            width: 100%;
            display: flex;
            justify-content: flex-end; /* Align button to the right */
            align-items: center;
            margin-bottom: 15px; /* Reduced margin */
        }

        #new-game-button {
            padding: 8px 12px; /* Smaller button */
            font-size: clamp(0.9em, 3vw, 1em);
            font-weight: bold;
            cursor: pointer;
            border: none;
            background-color: #8f7a66;
            color: white;
            border-radius: 3px;
            transition: background-color 0.2s ease;
            margin-left: auto; /* Push to the right */
        }

        #new-game-button:hover {
            background-color: #776e65;
        }

        /* Game Board Area*/
        #game-board-area {
             width: 100%;
             /* Calculate height to be square based on width */
             height: 0;
             padding-bottom: 100%; /* Aspect ratio 1:1 */
             position: relative; /* Anchor for board and tiles */
             margin-top: auto; /* Push board towards bottom if space allows */
             margin-bottom: auto;
        }


        /* Game Board Background Grid */
        #game-board-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #bbada0;
            border-radius: 6px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: clamp(8px, 2vw, 15px); /* Responsive gap */
            padding: clamp(8px, 2vw, 15px); /* Responsive padding */
            z-index: 1;
        }

        .grid-cell {
            background-color: rgba(238, 228, 218, 0.35);
            border-radius: 3px;
        }

        /* Tile Container - On top of grid */
         #tile-container {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             z-index: 2;
             /* Padding/gap is handled by tile positioning calculations */
             pointer-events: none; /* Don't block interaction with board below if needed */
        }

        /* Tiles */
        .tile {
            position: absolute;
            /* Width and Height calculated by JS */
            border-radius: 3px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1.2em, 5vw, 2.5em); /* Responsive font size */
            transition: top 0.1s ease-out, left 0.1s ease-out; /* Movement transition */
            /* Background/color transition handled by spawn/merge */
            z-index: 2;
            user-select: none; /* Prevent text selection */
        }

        /* Adjust font size for larger numbers */
        .tile[data-value="128"], .tile[data-value="256"], .tile[data-value="512"] { font-size: clamp(1em, 4.5vw, 2em); }
        .tile[data-value="1024"], .tile[data-value="2048"] { font-size: clamp(0.8em, 4vw, 1.7em); }
        .tile[data-value="4096"], .tile[data-value="8192"] { font-size: clamp(0.7em, 3.5vw, 1.5em); }


        /* Tile Colors */
        .tile[data-value="2"]    { background-color: #eee4da; color: #776e65; }
        .tile[data-value="4"]    { background-color: #ede0c8; color: #776e65; }
        .tile[data-value="8"]    { background-color: #f2b179; color: #f9f6f2; }
        .tile[data-value="16"]   { background-color: #f59563; color: #f9f6f2; }
        .tile[data-value="32"]   { background-color: #f67c5f; color: #f9f6f2; }
        .tile[data-value="64"]   { background-color: #f65e3b; color: #f9f6f2; }
        .tile[data-value="128"]  { background-color: #edcf72; color: #f9f6f2; }
        .tile[data-value="256"]  { background-color: #edcc61; color: #f9f6f2; }
        .tile[data-value="512"]  { background-color: #edc850; color: #f9f6f2; }
        .tile[data-value="1024"] { background-color: #edc53f; color: #f9f6f2; }
        .tile[data-value="2048"] { background-color: #edc22e; color: #f9f6f2; }
        .tile[data-value="4096"] { background-color: #3c3a32; color: #f9f6f2; }
        .tile[data-value="8192"] { background-color: #35332d; color: #f9f6f2; }


        /* Tile Animations */
        .tile-new {
            animation: spawn 0.2s ease-out;
        }
        .tile-merged {
            animation: merge 0.2s ease-in-out;
            z-index: 3; /* Ensure merged tiles are briefly on top */
        }

        @keyframes spawn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes merge {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Game Over / Win / Stage Overlay */